/*
 Copyright (c) 2021

 All rights reserved.
 */
package com.spandigital.codechallenge.ranking;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;

import java.io.IOException;
import java.nio.file.FileSystems;
import java.nio.file.Files;
import java.nio.file.Path;
import java.util.Arrays;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;

/**
 * <p><b>Purpose:</b><br>
 * <br>
 *
 * <p><b>Title:</b> RankingCalculatorTest<br>
 * <br>
 *
 * @author Kumbirai 'Coach' Mundangepfupfu<br>
 * @date 26 May 2021<br>
 * @version 1.0<br>
 *
 * <b>Revision:</b>
 * <br>
 *					
 */
class RankingCalculatorTest
{

	/**
	 * Constructor:
	 */
	public RankingCalculatorTest()
	{
		super();
	}

	@Test
	void test_constructor_fileNotFound()
	{
		assertThrows(IOException.class, () ->
		{
			new RankingCalculator("test.txt");
		});
	}

	/**
	 * Purpose:<br>
	 * <br>
	 * test_calculateRanking<br>
	 * <br>
	 * @return<br>
	 * <br>
	 */
	private static Stream<Arguments> test_calculateRanking()
	{
		return Stream.of(Arguments.of("Lions 3, Snakes 3", "Lions, 1 pt" + System.lineSeparator() + "Snakes, 1 pt"),
				Arguments.of("Lions 3, Snakes 1", "Lions, 3 pts" + System.lineSeparator() + "Snakes, 0 pts"),
				Arguments.of("Lions 1, Snakes 3", "Snakes, 3 pts" + System.lineSeparator() + "Lions, 0 pts"));
	}

	/**
	 * Purpose:<br>
	 * <br>
	 * test_calculateRanking<br>
	 * <br>
	 * @param match
	 * @param expected
	 * @throws Exception<br>
	 * <br>
	 */
	@ParameterizedTest
	@MethodSource
	void test_calculateRanking(String match, String expected) throws Exception
	{
		RankingCalculator rankingCalculator = new RankingCalculator(Arrays.asList(match));
		rankingCalculator.calculateRanking();
		assertEquals(expected, readOutputFile());
	}

	/**
	 * Purpose:<br>
	 * <br>
	 * readOutputFile<br>
	 * <br>
	 * @return
	 * @throws IOException<br>
	 * <br>
	 */
	private String readOutputFile() throws IOException
	{
		Path scoreFilePath = FileSystems.getDefault()
				.getPath("", RankingCalculator.OUTPUT_FILE)
				.toAbsolutePath();
		String output;
		try (Stream<String> stream = Files.lines(scoreFilePath))
		{
			output = stream.collect(Collectors.joining(System.lineSeparator()));
		}
		return output;
	}
}
